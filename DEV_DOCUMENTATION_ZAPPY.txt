                  ğŸ“ Documentation DÃ©veloppeur
                    Projet Zappy by EPITECH
                        Juin 2025

                Sommaire :

          1. PrÃ©ambule ğŸ“š
            1.1 ğŸ§  PrÃ©sentation du projet
            1.2 ğŸ¯ Objectif du projet
            1.3 ğŸŒ Le monde de Trantor
          2. Serveur Zappy (C) ğŸ’»
            2.1 ğŸ§± Structure gÃ©nÃ©rale
            2.2 ğŸ§© Composants principaux
            2.3 ğŸ”„ Boucle principale du serveur
            2.4 ğŸ‘¥ Gestion des clients
            2.5 ğŸ—ºï¸ Carte et ressources
            2.6 ğŸ“º Protocole GUI
            2.7 ğŸ’€ Vie et mort
            2.8 ğŸ§® Parsing des arguments
          3. IA Zappy (Rust) ğŸ¤–
            3.1 ğŸ“¦ Create : zappy_ai
            3.2 ğŸ§  Structure Principale
            3.3 ğŸ”Œ Connexion & Initialisation
            3.4 ğŸ—ºï¸ Map cÃ´tÃ© IA
            3.5 âš™ï¸ Commandes IA
            3.6 ğŸ“¨ Envoi de commande
            3.7 âœ… Commandes utilitaires
            3.8 ğŸ§ª RÃ©ponses attendues
          4. GUI Zappy (C++/SFML) ğŸ¨
            4.1 ğŸ¨ Structure GÃ©nÃ©rale
            4.2 ğŸ”— Connexion au serveur
            4.3 ğŸ–¥ï¸ Affichage
            4.4 ğŸ® ContrÃ´les
            4.5 ğŸŒ Rendu de la carte
            4.6 ğŸ“¬ Communication serveur
            4.7 ğŸ› ï¸ Architecture interne
          

--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     1/8
--------------------------------------------------------

-----------------------------------------------------------------
ğŸ“Documentation DÃ©veloppeur                          Projet Zappy
-----------------------------------------------------------------


---------------------------------------------------------------------      
      1. PrÃ©ambule ğŸ“š
---------------------------------------------------------------------


Bienvenue dans la documentation dÃ©veloppeur du projet zappy 

ğŸ§  PrÃ©sentation du projet :
    Zappy est un jeu multijoueur en rÃ©seau, inspirÃ© de lâ€™univers de
    la science-fiction. Il plonge les joueurs dans un monde en 2D
    nommÃ© Trantor, oÃ¹ plusieurs Ã©quipes sâ€™affrontent pour
    atteindre lâ€™Ã©lÃ©vation suprÃªme, symbole de puissance et de
    sagesse dans ce monde pacifique.

ğŸ¯ Objectif du projet :
    Chaque joueur incarne un Trantorien, un Ãªtre curieux et non-
    violent, qui Ã©volue sur une carte contenant diffÃ©rentes
    ressources. Le but est de faire progresser son Ã©quipe : la
    premiÃ¨re Ã©quipe Ã  faire atteindre le niveau 8 Ã  au moins 6 de
    ses membres remporte la partie.

ğŸŒ Le Monde de Trantor :
    Le monde est une carte en 2D sans relief, il est toroÃ¯dal : sortez
    dâ€™un cÃ´tÃ© et vous rÃ©apparaÃ®trez de lâ€™autre cÃ´tÃ©.
    De nombreuses ressources naturelles apparaissent au fil du
    temps :
       - De la nourriture pour survivre
       - Des minÃ©raux : linemate, deraumere, sibur, mendiane, phiras, thystame
    Ces ressources sont fondamentales pour survivre et sâ€™Ã©lever
    dans la hiÃ©rarchie.


--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     2/8
--------------------------------------------------------

--------------------------------------------------------
ğŸ“Documentation DÃ©veloppeur                Projet Zappy
--------------------------------------------------------


---------------------------------------------------------------------       
      2. Serveur Zappy (C) ğŸ’»
---------------------------------------------------------------------


ğŸ§± 1. Structure gÃ©nÃ©rale
    Le serveur est codÃ© en C et repose sur :
    - des sockets TCP (poll pour I/O non bloquant),
    - une simulation temps rÃ©el basÃ©e sur des "ticks",
    - des clients IA et un client GRAPHIC (GUI),
    - une carte 2D avec ressources et joueurs.


ğŸ§© 2. Composants principaux
    | Composant          | Fichier(s)               | Description                                                      |
    |--------------------|--------------------------|------------------------------------------------------------------|
    |  server_t          | server.h, server.c       | Structure principale du serveur : map, clients, sockets          |
    |  client_t          | client.h                 | ReprÃ©sente un client IA ou GUI                                   |
    |  player_t          | player.h, player.c       | ReprÃ©sente un joueur (ID, position, inventaire, vie)             |
    |  team_t            | player.h                 | ReprÃ©sente une Ã©quipe et ses slots                               |
    |  map_t  /  tile_t  | map.h, map.c             | ReprÃ©sente la carte du jeu et ses ressources                     |
    |  server_config_t   | server.h, parse_args.c   | Contient les paramÃ¨tres de lancement                             |


ğŸ”„ 3. Boucle principale du serveur
    Fichier : server.c
      - launch_server :
        - RÃ©initialise les clients,
        - Lance une boucle infinie :
          - Attente avec poll,
          - Lecture des messages clients (read_client),
          - Appels Ã  update_player_life et generate_resources,
          - Mise Ã  jour GUI via send_gui_resource_changes.
    - handle_tick : gÃ¨re la frÃ©quence de jeu via gettimeofday.


ğŸ‘¥ 4. Gestion des clients
    Fichier : handle_client.c
      - read_client_data : lit les donnÃ©es dâ€™un client avec read().
      - handle_client_message : 
        - Si le message est "GRAPHIC", câ€™est un client GUI.
        - Sinon, on lâ€™enregistre comme joueur via handle_team_command.
      - register_player : crÃ©e un joueur (create_player) et lâ€™ajoute Ã  server->players.


--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     3/8
--------------------------------------------------------

--------------------------------------------------------
ğŸ“Documentation DÃ©veloppeur                 Projet Zappy
--------------------------------------------------------

ğŸ—ºï¸ 5. Carte et ressources
    Fichier : map.c
      - init_map : initialise la carte 2D.
      - generate_resources : distribue des ressources alÃ©atoirement.
      - tile_t.changed : indique si un bct doit Ãªtre envoyÃ© au client GUI.


ğŸ“º 6. Protocole GUI
    Fichier : send_data_to_gui.c
      Utilise dprintf() pour envoyer :
      - msz â†’ taille de la map,
      - bct x y ... â†’ contenu dâ€™une case,
      - pnw, pin â†’ info joueurs,
      - tna â†’ Ã©quipes,
      - pdi â†’ mort dâ€™un joueur.


ğŸ’€ 7. Vie et mort
    Fichier : player.c

      - Chaque joueur a un compteur life_remain et food_tick.
      - update_player_life :
        - dÃ©crÃ©mente life_remain,
        - consomme de la nourriture,
        - tue le joueur si besoin (dead\n + pdi au GUI).

ğŸ§® 8. Parsing des arguments
    Fichier : parse_args.c
      GÃ¨re les flags :
      - -p, -x, -y, -n, -c, -f
      Remplit la structure server_config_t.


--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     4/8
--------------------------------------------------------

--------------------------------------------------------
ğŸ“Documentation DÃ©veloppeur                 Projet Zappy
--------------------------------------------------------


---------------------------------------------------------------------
      3. IA Zappy (Rust) ğŸ¤–
---------------------------------------------------------------------


ğŸ“¦ 1. Create : zappy_ai
    - Langage : Rust (2021)
    - Asynchrone avec tokio
    - CLI avec clap
    - SÃ©rialisation avec serde


ğŸ§  2. Structure Principale
    | Composant            | Fichier(s)              | Description                                             |
    |----------------------|-------------------------|---------------------------------------------------------|
    | ZappyClient          | client.rs               | GÃ¨re la connexion TCP et la logique de communication    |
    | Command / Resource   | commands.rs             | Enum des commandes/ressources et logique associÃ©e       |
    | Map / Tile / Element | (structure utilisateur) | ReprÃ©sentation locale de la map cÃ´tÃ© IA                 |


ğŸ”Œ 3. Connexion & Initialisation
    ZappyClient::connect(...) -> Result<ZappyClient, ConnectionError>

    1. Se connecte au serveur (tokio TCP).
    2. Attend "WELCOME" du serveur.
    3. Envoie le nom dâ€™Ã©quipe.
    4. Lit :
      - Nombre de slots libres (int),
      - Dimensions de la map (w, h).
    5. Initialise la structure client.


ğŸ—ºï¸ 4. Map cÃ´tÃ© IA
    La carte est stockÃ© dans une structure Map qui contient Largeur, Hauteur et un vecteur de cases : 

    rust
    pub struct Map {
        width: usize,
        height: usize,
        tiles: Vec<Tile>,
    }
    pub struct Tile {
        pub element: Element,
    }
    #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash, Serialize, Deserialize)]
    pub enum Element {
        Empty, Wall, Player, Enemy, Projectile, PowerUp, Explosion,
        Obstacle, Trap, Portal, Collectible, Hazard, Platform,
        Ladder, Door, Key, Chest, Spawner, Checkpoint, Finish,
    }


--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     5/8
--------------------------------------------------------

--------------------------------------------------------
ğŸ“Documentation DÃ©veloppeur                 Projet Zappy
--------------------------------------------------------

âš™ï¸ 5. Commandes IA
    Les commandes sont dÃ©finies dans l'enum Command :

    rust
    pub enum Command {
        Forward, Right, Left, Look, Inventory,
        Broadcast(String), ConnectNbr, Fork,
        Eject, Take(Resource), Set(Resource), Incantation,
    }
    - Chaque commande possÃ¨de :
      - to_string() : transforme en texte Ã  envoyer.
      - get_duration(freq) : calcule la durÃ©e dâ€™exÃ©cution.


ğŸ“¨ 6. Envoi de commande

    rust
    pub async fn execute_command(&mut self, cmd: Command) -> io::Result<String>

    - Envoie la commande,
    - Attend une rÃ©ponse (tokio async),
    - Retourne ok, ko, ou autre.


âœ… 7. Commandes utilitaires :

    Ces commandes sont des fonctions async fournies par le client IA qui facilitent lâ€™envoi des commandes IA au serveur en gÃ©rant 
    la communication et les rÃ©ponses automatiquement :
      rust
      forward(), right(), left(), look(), inventory()
      take(resource), set(resource), fork(), incantation()
      broadcast("msg"), connect_nbr(), eject()


--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     6/8
--------------------------------------------------------

--------------------------------------------------------
ğŸ“Documentation DÃ©veloppeur                 Projet Zappy
--------------------------------------------------------

ğŸ§ª 8. RÃ©ponses attendues :
    | Commande      | RÃ©ponse                  |
    |---------------|--------------------------|
    | Forward       | ok / ko                  |
    | Inventory     | [food 1, linemate 0...]  |
    | Look          | [ linemate, food ... ]   |
    | Connect_nbr   | 2                        |
    | Incantation   | Elevation underway       |


---------------------------------------------------------------------
      4. GUI Zappy (C++/SFML) ğŸ¨
---------------------------------------------------------------------


ğŸ¨ 1. Structure GÃ©nÃ©rale
    - Application graphique dÃ©veloppÃ©e en C++ avec la bibliothÃ¨que SFML.
    - Interface de visualisation de la carte et des joueurs.
    - Interaction utilisateur via clavier pour dÃ©placement et navigation.


ğŸ”— 2. Connexion au serveur
    - Socket TCP en mode non bloquant.
    - Envoie du message "GRAPHIC\n" pour sâ€™identifier au serveur.
    - Attend la rÃ©ponse "WELCOME" avant dâ€™afficher lâ€™interface.


ğŸ–¥ï¸ 3. Affichage
    - FenÃªtre SFML 1920x1080 pixels.
    - Deux modes dâ€™affichage :
    - Menu initial avec instructions,
    - Carte isomÃ©trique avec tuiles et joueurs.

--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     7/8
--------------------------------------------------------

--------------------------------------------------------
ğŸ“Documentation DÃ©veloppeur                 Projet Zappy
--------------------------------------------------------

ğŸ® 4. ContrÃ´les
    - Z, Q, S, D pour dÃ©placer la vue isomÃ©trique.
      - Z : Avancer
      - Q : Aller Ã  droite
      - S : Reculer
      - D : Aller Ã  gauche
    - EntrÃ©e pour passer du menu Ã  la vue carte.


ğŸŒ 5. Rendu de la carte
    - Calcul des positions isomÃ©triques des tuiles.
    - Dessin des tuiles en forme de losange (ConvexShape).
    - Couleurs et contours pour une meilleure lisibilitÃ©.


ğŸ“¬ 6. Communication serveur
    - Lecture en continu des messages via socket.
    - Bufferage et dÃ©coupage des messages terminÃ©s par '\n'.
    - Parsing des messages pour mise Ã  jour de la carte et des joueurs.


ğŸ› ï¸ 7. Architecture interne
    - Classes :
      - gui : gÃ¨re la connexion, les Ã©vÃ©nements, le rendu.
      - Map : stocke la carte et les tuiles.
      - Tile et Player : reprÃ©sentent les cases et joueurs.

--------------------------------------------------------
Erwan | Gustave | Zoltan | Aymen                     8/8
--------------------------------------------------------